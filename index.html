<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dark com Insights - An√°lise Bitruck vs Carreta</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f1e;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #1a1a3e 0%, #16213e 100%);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a2a5e;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.1em;
            color: #a0a0c0;
            margin-top: 10px;
        }

        /* Abas */
        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #2a2a5e;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #7a7a9e;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            color: #667eea;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Painel de Controle */
        .control-panel {
            background: #1a1a2e;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a2a5e;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a2a5e;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #b0b0d0;
            font-size: 0.95em;
        }

        select, input[type="color"], input[type="range"], input[type="number"] {
            padding: 10px 12px;
            border: 2px solid #2a2a5e;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: #16213e;
            color: #e0e0e0;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        input[type="color"] {
            height: 45px;
            cursor: pointer;
            padding: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #2a2a5e;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .btn-secondary:hover {
            background: #3a3a7e;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ff5252;
            color: white;
        }

        .btn-danger:hover {
            background: #ff3838;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #00c853;
            color: white;
        }

        .btn-success:hover {
            background: #00a844;
            transform: translateY(-2px);
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }

        /* KPI Cards */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #1a1a3e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid #2a2a5e;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .kpi-label {
            font-size: 0.9em;
            color: #7a7a9e;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .kpi-change {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 5px;
        }

        .kpi-change.positive {
            background: rgba(0, 200, 83, 0.2);
            color: #00c853;
            border: 1px solid #00c853;
        }

        .kpi-change.negative {
            background: rgba(255, 23, 68, 0.2);
            color: #ff1744;
            border: 1px solid #ff1744;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: linear-gradient(135deg, #1a1a3e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            border: 1px solid #2a2a5e;
        }

        .chart-card:hover {
            transform: scale(1.02);
            border-color: #667eea;
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chart-title {
            font-size: 1.3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chart-controls button {
            padding: 6px 12px;
            font-size: 12px;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .chart-container.large {
            height: 400px;
        }

        /* Preset Buttons */
        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .preset-btn {
            padding: 8px 16px;
            border: 2px solid #2a2a5e;
            background: transparent;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .preset-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        /* Insights Section */
        .insights-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insight-card {
            background: linear-gradient(135deg, #1a1a3e 0%, #16213e 100%);
            border: 1px solid #2a2a5e;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .insight-card:hover {
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
            transform: translateY(-3px);
        }

        .insight-card.positive {
            border-left-color: #00c853;
        }

        .insight-card.negative {
            border-left-color: #ff1744;
        }

        .insight-card.neutral {
            border-left-color: #4facfe;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .insight-icon {
            font-size: 24px;
        }

        .insight-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #fff;
        }

        .insight-content {
            font-size: 0.95em;
            color: #b0b0d0;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .insight-metric {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            margin: 2px;
            border: 1px solid #667eea;
        }

        .insight-metric.positive {
            background: rgba(0, 200, 83, 0.1);
            border-color: #00c853;
            color: #00c853;
        }

        .insight-metric.negative {
            background: rgba(255, 23, 68, 0.1);
            border-color: #ff1744;
            color: #ff1744;
        }

        /* An√°lise Detalhada */
        .analysis-section {
            background: linear-gradient(135deg, #1a1a3e 0%, #16213e 100%);
            border: 1px solid #2a2a5e;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .analysis-title {
            font-size: 1.4em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analysis-item {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid #2a2a5e;
            border-radius: 10px;
            padding: 15px;
        }

        .analysis-item-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .analysis-item-content {
            color: #b0b0d0;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .metric-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
            margin: 0 2px;
        }

        .metric-value.positive {
            background: #00c853;
        }

        .metric-value.negative {
            background: #ff1744;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
            border: 1px solid #2a2a5e;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #7a7a9e;
        }

        .modal-close:hover {
            color: #667eea;
        }

        /* Range Slider */
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #2a2a5e;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
        }

        .range-value {
            font-size: 0.9em;
            color: #7a7a9e;
            margin-top: 5px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0f0f1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #2a2a5e;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a3a7e;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .control-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .kpi-value {
                font-size: 2em;
            }

            .tabs-container {
                flex-direction: column;
            }

            .tab-button {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Dashboard Dark com Insights</h1>
            <p class="subtitle">An√°lise Completa - Bitruck vs Carreta (Out/24 a Out/25)</p>
        </header>

        <!-- Abas -->
        <div class="tabs-container">
            <button class="tab-button active" onclick="switchTab('dashboard')">üìà Dashboard</button>
            <button class="tab-button" onclick="switchTab('insights')">üí° Insights</button>
            <button class="tab-button" onclick="switchTab('analysis')">üîç An√°lise Detalhada</button>
            <button class="tab-button" onclick="switchTab('abbrasil')">üìä AB Brasil</button>
        </div>

        <!-- Aba 1: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <!-- Painel de Controle -->
            <div class="control-panel">
                <div class="control-section">
                    <div class="section-title">üîç Filtros de Per√≠odo</div>
                    <div class="preset-buttons">
                        <button class="preset-btn active" onclick="applyPreset('all')">Todos</button>
                        <button class="preset-btn" onclick="applyPreset('2024')">2024</button>
                        <button class="preset-btn" onclick="applyPreset('2025')">2025</button>
                        <button class="preset-btn" onclick="applyPreset('last6')">√öltimos 6 meses</button>
                        <button class="preset-btn" onclick="applyPreset('last3')">√öltimos 3 meses</button>
                    </div>
                    <div class="control-grid">
                        <div class="control-group">
                            <label for="startMonth">M√™s Inicial:</label>
                            <select id="startMonth"></select>
                        </div>
                        <div class="control-group">
                            <label for="endMonth">M√™s Final:</label>
                            <select id="endMonth"></select>
                        </div>
                        <div class="control-group">
                            <button class="btn-primary" onclick="applyCustomRange()">Aplicar Per√≠odo</button>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üìà Tipos de Gr√°ficos</div>
                    <div class="control-grid">
                        <div class="control-group">
                            <label for="lineChartType">Gr√°fico de Linha:</label>
                            <select id="lineChartType" onchange="updateChartType('line', this.value)">
                                <option value="line">Linha</option>
                                <option value="bar">Barras</option>
                                <option value="area">√Årea</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="barChartType">Gr√°fico de Compara√ß√£o:</label>
                            <select id="barChartType" onchange="updateChartType('bar', this.value)">
                                <option value="bar">Barras Agrupadas</option>
                                <option value="line">Linha</option>
                                <option value="radar">Radar</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="pieChartType">Gr√°fico de Distribui√ß√£o:</label>
                            <select id="pieChartType" onchange="updateChartType('pie', this.value)">
                                <option value="doughnut">Donut</option>
                                <option value="pie">Pizza</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üé® Cores e Estilo</div>
                    <div class="control-grid">
                        <div class="control-group">
                            <label for="colorBitruck">Cor Bitruck:</label>
                            <input type="color" id="colorBitruck" value="#667eea" onchange="updateColors()">
                        </div>
                        <div class="control-group">
                            <label for="colorCarreta">Cor Carreta:</label>
                            <input type="color" id="colorCarreta" value="#764ba2" onchange="updateColors()">
                        </div>
                        <div class="control-group">
                            <label for="colorTotal">Cor Total:</label>
                            <input type="color" id="colorTotal" value="#f093fb" onchange="updateColors()">
                        </div>
                        <div class="control-group">
                            <label for="colorRevenue">Cor Faturamento:</label>
                            <input type="color" id="colorRevenue" value="#4facfe" onchange="updateColors()">
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üëÅÔ∏è Op√ß√µes de Visualiza√ß√£o</div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="showLegend" checked onchange="updateVisualization()">
                            <label for="showLegend">Mostrar Legenda</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showGrid" checked onchange="updateVisualization()">
                            <label for="showGrid">Mostrar Grade</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showPoints" checked onchange="updateVisualization()">
                            <label for="showPoints">Mostrar Pontos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showTooltip" checked onchange="updateVisualization()">
                            <label for="showTooltip">Mostrar Tooltips</label>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">‚öôÔ∏è Op√ß√µes Avan√ßadas</div>
                    <div class="control-grid">
                        <div class="control-group">
                            <label for="lineWidth">Espessura da Linha: <span class="range-value" id="lineWidthValue">3</span></label>
                            <input type="range" id="lineWidth" min="1" max="5" value="3" onchange="updateAdvanced()">
                        </div>
                        <div class="control-group">
                            <label for="pointSize">Tamanho dos Pontos: <span class="range-value" id="pointSizeValue">5</span></label>
                            <input type="range" id="pointSize" min="2" max="10" value="5" onchange="updateAdvanced()">
                        </div>
                        <div class="control-group">
                            <label for="opacity">Opacidade: <span class="range-value" id="opacityValue">0.3</span></label>
                            <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.3" onchange="updateAdvanced()">
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="section-title">üéØ A√ß√µes</div>
                    <div class="button-group">
                        <button class="btn-success" onclick="downloadChart('lineChart')">üì• Exportar Gr√°fico</button>
                        <button class="btn-secondary" onclick="savePreset()">üíæ Salvar Configura√ß√£o</button>
                        <button class="btn-primary" onclick="loadPreset()">üìÇ Carregar Configura√ß√£o</button>
                        <button class="btn-danger" onclick="resetAll()">üîÑ Resetar Tudo</button>
                    </div>
                </div>
            </div>

            <!-- KPIs -->
            <div class="kpi-container" id="kpiContainer"></div>

            <!-- Gr√°ficos -->
            <div class="charts-grid">
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <span class="chart-title">Evolu√ß√£o Temporal - Bitruck vs Carreta</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('lineChart')">‚¨áÔ∏è Download</button>
                            <button class="btn-secondary" onclick="toggleChartFullscreen('lineChart')">‚õ∂ Tela Cheia</button>
                        </div>
                    </div>
                    <div class="chart-container large">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Compara√ß√£o de Volumes</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('barChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Distribui√ß√£o Percentual</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('pieChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-header">
                        <span class="chart-title">Oscila√ß√£o do Total de Ve√≠culos</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('totalChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="totalChart"></canvas>
                    </div>
                </div>

                <div class="chart-card full-width">
                    <div class="chart-header">
                        <span class="chart-title">Varia√ß√£o de Faturamento</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('revenueChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aba 2: Insights -->
        <div id="insights" class="tab-content">
            <div class="insights-container" id="insightsContainer"></div>
        </div>

        <!-- Aba 3: An√°lise Detalhada -->
        <div id="analysis" class="tab-content">
            <div class="analysis-section">
                <div class="analysis-title">üìä An√°lise de Crescimento e Decr√©scimo</div>
                <div class="analysis-grid" id="analysisContainer"></div>
            </div>

            <div class="analysis-section">
                <div class="analysis-title">üéØ Considera√ß√µes Estrat√©gicas</div>
                <div class="analysis-grid" id="considerationsContainer"></div>
            </div>
        </div>
    </div>


        <!-- Aba 4: AB Brasil -->
        <div id="abbrasil" class="tab-content">
            <div class="analysis-section">
                <h2 class="analysis-title">üìä Propor√ß√£o do Volume de Cargas AB Brasil</h2>
                <p class="analysis-description">
                    An√°lise da participa√ß√£o percentual da AB Brasil no volume total de cargas transportadas de Janeiro a Outubro de 2025.
                </p>
            </div>

            <!-- KPI AB Brasil -->
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-label">M√©dia AB Brasil 2025</div>
                    <div class="kpi-value" id="abBrasilMedia">31,91%</div>
                    <div class="kpi-change neutral">
                        üìà Participa√ß√£o m√©dia
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Maior Participa√ß√£o</div>
                    <div class="kpi-value" id="abBrasilMax">34,79%</div>
                    <div class="kpi-change positive">
                        üìÖ Junho/25
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Menor Participa√ß√£o</div>
                    <div class="kpi-value" id="abBrasilMin">26,18%</div>
                    <div class="kpi-change negative">
                        üìÖ Abril/25
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Amplitude</div>
                    <div class="kpi-value" id="abBrasilAmplitude">8,61%</div>
                    <div class="kpi-change neutral">
                        üìä Varia√ß√£o
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos AB Brasil -->
            <div class="charts-grid">
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <span class="chart-title">Evolu√ß√£o da Propor√ß√£o AB Brasil (2025)</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('abBrasilLineChart')">‚¨áÔ∏è Download</button>
                            <button class="btn-secondary" onclick="toggleChartFullscreen('abBrasilLineChart')">‚õ∂ Tela Cheia</button>
                        </div>
                    </div>
                    <div class="chart-container large">
                        <canvas id="abBrasilLineChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Distribui√ß√£o Mensal AB Brasil</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('abBrasilBarChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="abBrasilBarChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">M√©dia Trimestral</span>
                        <div class="chart-controls">
                            <button class="btn-primary" onclick="downloadChart('abBrasilTrimChart')">‚¨áÔ∏è Download</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="abBrasilTrimChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Insights AB Brasil -->
            <div class="analysis-section" style="margin-top: 30px;">
                <h3 class="analysis-subtitle">üìà Insights AB Brasil</h3>
                <div class="insights-container">
                    <div class="insight-card positive">
                        <div class="insight-header">
                            <span class="insight-icon">üìä</span>
                            <span class="insight-title">Participa√ß√£o Consistente</span>
                        </div>
                        <div class="insight-content">
                            A AB Brasil manteve uma participa√ß√£o m√©dia de <span class="insight-metric positive">31,91%</span> 
                            no volume total de cargas durante 2025, demonstrando presen√ßa consistente no mercado.
                        </div>
                    </div>

                    <div class="insight-card positive">
                        <div class="insight-header">
                            <span class="insight-icon">üéØ</span>
                            <span class="insight-title">Melhor Performance</span>
                        </div>
                        <div class="insight-content">
                            O m√™s de <span class="insight-metric positive">Junho/25</span> registrou a maior participa√ß√£o 
                            com <span class="insight-metric positive">34,79%</span>, indicando forte desempenho no per√≠odo.
                        </div>
                    </div>

                    <div class="insight-card negative">
                        <div class="insight-header">
                            <span class="insight-icon">‚ö†Ô∏è</span>
                            <span class="insight-title">Ponto de Aten√ß√£o</span>
                        </div>
                        <div class="insight-content">
                            <span class="insight-metric negative">Abril/25</span> apresentou a menor participa√ß√£o 
                            com <span class="insight-metric negative">26,18%</span>, sugerindo necessidade de an√°lise 
                            dos fatores que influenciaram essa queda.
                        </div>
                    </div>

                    <div class="insight-card neutral">
                        <div class="insight-header">
                            <span class="insight-icon">üìâ</span>
                            <span class="insight-title">Variabilidade</span>
                        </div>
                        <div class="insight-content">
                            A amplitude de <span class="insight-metric">8,61%</span> entre o maior e menor valor 
                            indica uma varia√ß√£o moderada na participa√ß√£o ao longo do ano.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Modal para Fullscreen -->
    <div id="fullscreenModal" class="modal" onclick="closeFullscreen(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeFullscreen()">&times;</span>
            <div style="position: relative; height: 600px;">
                <canvas id="fullscreenChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Registrar plugin datalabels globalmente
        Chart.register(ChartDataLabels);
        
        // Dados ATUALIZADOS com outubro/2025
        const rawData = [
            {"mes": "out/24", "bitruck": 47, "carreta": 101, "total": 148, "faturamento": 1603236.0},
            {"mes": "nov/24", "bitruck": 41, "carreta": 94, "total": 135, "faturamento": 1410196.0},
            {"mes": "dez/24", "bitruck": 31, "carreta": 81, "total": 112, "faturamento": 1223970.0},
            {"mes": "jan/25", "bitruck": 51, "carreta": 76, "total": 127, "faturamento": 1380761.0},
            {"mes": "fev/25", "bitruck": 45, "carreta": 70, "total": 115, "faturamento": 1217982.0},
            {"mes": "mar/25", "bitruck": 60, "carreta": 78, "total": 138, "faturamento": 1487483.0},
            {"mes": "abr/25", "bitruck": 44, "carreta": 67, "total": 111, "faturamento": 1195971.0},
            {"mes": "mai/25", "bitruck": 58, "carreta": 99, "total": 157, "faturamento": 1668755.0},
            {"mes": "jun/25", "bitruck": 73, "carreta": 86, "total": 159, "faturamento": 1700861.0},
            {"mes": "jul/25", "bitruck": 79, "carreta": 81, "total": 160, "faturamento": 1841835.0},
            {"mes": "ago/25", "bitruck": 80, "carreta": 100, "total": 180, "faturamento": 1985641.0},
            {"mes": "set/25", "bitruck": 68, "carreta": 61, "total": 129, "faturamento": 1483689.0},
            {"mes": "out/25", "bitruck": 82, "carreta": 67, "total": 149, "faturamento": 1757128.0}
        ];

        let currentData = [...rawData];
        let charts = {};
        let chartTypes = {
            line: 'line',
            bar: 'bar',
            pie: 'doughnut'
        };

        let colors = {
            bitruck: '#667eea',
            carreta: '#764ba2',
            total: '#f093fb',
            revenue: '#4facfe'
        };

        // Trocar abas
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Inicializar selects
        function initializeSelects() {
            const startSelect = document.getElementById('startMonth');
            const endSelect = document.getElementById('endMonth');
            
            rawData.forEach((d, index) => {
                const option1 = document.createElement('option');
                option1.value = index;
                option1.textContent = d.mes;
                startSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = index;
                option2.textContent = d.mes;
                endSelect.appendChild(option2);
            });
            
            endSelect.selectedIndex = rawData.length - 1;
        }

        // Formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 0
            }).format(value);
        }

        // Calcular KPIs
        function calculateKPIs(data) {
            if (data.length === 0) return null;
            
            const totalBitruck = data.reduce((sum, d) => sum + d.bitruck, 0);
            const totalCarreta = data.reduce((sum, d) => sum + d.carreta, 0);
            const totalVeiculos = data.reduce((sum, d) => sum + d.total, 0);
            const totalFaturamento = data.reduce((sum, d) => sum + d.faturamento, 0);
            
            const firstMonth = data[0];
            const lastMonth = data[data.length - 1];
            
            const bitruckChange = ((lastMonth.bitruck - firstMonth.bitruck) / firstMonth.bitruck * 100).toFixed(1);
            const carretaChange = ((lastMonth.carreta - firstMonth.carreta) / firstMonth.carreta * 100).toFixed(1);
            const totalChange = ((lastMonth.total - firstMonth.total) / firstMonth.total * 100).toFixed(1);
            const revenueChange = ((lastMonth.faturamento - firstMonth.faturamento) / firstMonth.faturamento * 100).toFixed(1);

            return {
                totalBitruck, totalCarreta, totalVeiculos, totalFaturamento,
                bitruckChange, carretaChange, totalChange, revenueChange
            };
        }

        // Renderizar KPIs
        function renderKPIs(data) {
            const kpis = calculateKPIs(data);
            if (!kpis) return;
            
            const container = document.getElementById('kpiContainer');
            
            container.innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Total Bitruck</div>
                    <div class="kpi-value">${kpis.totalBitruck}</div>
                    <div class="kpi-change ${kpis.bitruckChange >= 0 ? 'positive' : 'negative'}">
                        ${kpis.bitruckChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpis.bitruckChange)}%
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Total Carreta</div>
                    <div class="kpi-value">${kpis.totalCarreta}</div>
                    <div class="kpi-change ${kpis.carretaChange >= 0 ? 'positive' : 'negative'}">
                        ${kpis.carretaChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpis.carretaChange)}%
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Total Ve√≠culos</div>
                    <div class="kpi-value">${kpis.totalVeiculos}</div>
                    <div class="kpi-change ${kpis.totalChange >= 0 ? 'positive' : 'negative'}">
                        ${kpis.totalChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpis.totalChange)}%
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Faturamento Total</div>
                    <div class="kpi-value" style="font-size: 1.8em;">${formatCurrency(kpis.totalFaturamento)}</div>
                    <div class="kpi-change ${kpis.revenueChange >= 0 ? 'positive' : 'negative'}">
                        ${kpis.revenueChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpis.revenueChange)}%
                    </div>
                </div>
            `;
        }

        // Gerar Insights
        function generateInsights(data) {
            const insights = [];
            
            // An√°lise Bitruck
            const bitruckStart = data[0].bitruck;
            const bitruckEnd = data[data.length - 1].bitruck;
            const bitruckChange = ((bitruckEnd - bitruckStart) / bitruckStart * 100).toFixed(1);
            const bitruckMax = Math.max(...data.map(d => d.bitruck));
            const bitruckMin = Math.min(...data.map(d => d.bitruck));
            
            insights.push({
                icon: 'üöõ',
                title: 'Crescimento de Bitruck',
                content: `Bitruck apresentou crescimento consistente de <span class="insight-metric positive">${bitruckChange}%</span> no per√≠odo, variando de <span class="insight-metric">${bitruckMin}</span> a <span class="insight-metric positive">${bitruckMax}</span> unidades.`,
                type: 'positive'
            });

            // An√°lise Carreta
            const carretaStart = data[0].carreta;
            const carretaEnd = data[data.length - 1].carreta;
            const carretaChange = ((carretaEnd - carretaStart) / carretaStart * 100).toFixed(1);
            const carretaMax = Math.max(...data.map(d => d.carreta));
            const carretaMin = Math.min(...data.map(d => d.carreta));
            
            insights.push({
                icon: 'üöö',
                title: 'Redu√ß√£o de Carreta',
                content: `Carreta apresentou redu√ß√£o de <span class="insight-metric negative">${carretaChange}%</span>, variando de <span class="insight-metric">${carretaMin}</span> a <span class="insight-metric">${carretaMax}</span> unidades, refletindo mudan√ßa estrat√©gica.`,
                type: 'negative'
            });

            // An√°lise Total
            const totalStart = data[0].total;
            const totalEnd = data[data.length - 1].total;
            const totalChange = ((totalEnd - totalStart) / totalStart * 100).toFixed(1);
            const totalMax = Math.max(...data.map(d => d.total));
            const totalMin = Math.min(...data.map(d => d.total));
            
            insights.push({
                icon: 'üìä',
                title: 'Oscila√ß√£o do Total de Ve√≠culos',
                content: `Total de ve√≠culos variou <span class="insight-metric">${totalChange}%</span>, com pico de <span class="insight-metric positive">${totalMax}</span> e m√≠nimo de <span class="insight-metric">${totalMin}</span> unidades.`,
                type: 'neutral'
            });

            // An√°lise Faturamento
            const revenueStart = data[0].faturamento;
            const revenueEnd = data[data.length - 1].faturamento;
            const revenueChange = ((revenueEnd - revenueStart) / revenueStart * 100).toFixed(1);
            const revenueTotal = data.reduce((sum, d) => sum + d.faturamento, 0);
            const revenueAvg = (revenueTotal / data.length).toFixed(0);
            
            insights.push({
                icon: 'üí∞',
                title: 'Desempenho Financeiro',
                content: `Faturamento total de <span class="insight-metric positive">${formatCurrency(revenueTotal)}</span> com m√©dia de <span class="insight-metric">${formatCurrency(revenueAvg)}</span>/m√™s, varia√ß√£o de <span class="insight-metric positive">${revenueChange}%</span>.`,
                type: 'positive'
            });

            // An√°lise de Efici√™ncia
            const avgRevenuePerVehicle = (revenueTotal / data.reduce((sum, d) => sum + d.total, 0)).toFixed(0);
            
            insights.push({
                icon: '‚ö°',
                title: 'Efici√™ncia Operacional',
                content: `Faturamento m√©dio por ve√≠culo: <span class="insight-metric">${formatCurrency(avgRevenuePerVehicle)}</span>. Indicador de efici√™ncia mantido apesar da mudan√ßa na composi√ß√£o da frota.`,
                type: 'neutral'
            });

            // An√°lise de Tend√™ncia
            const recentMonths = data.slice(-3);
            const recentBitruckAvg = (recentMonths.reduce((sum, d) => sum + d.bitruck, 0) / recentMonths.length).toFixed(0);
            const recentCarretaAvg = (recentMonths.reduce((sum, d) => sum + d.carreta, 0) / recentMonths.length).toFixed(0);
            
            insights.push({
                icon: 'üìà',
                title: 'Tend√™ncia Recente (√öltimos 3 meses)',
                content: `Bitruck mant√©m m√©dia de <span class="insight-metric positive">${recentBitruckAvg}</span> unidades, enquanto Carreta estabiliza em <span class="insight-metric">${recentCarretaAvg}</span> unidades, consolidando nova estrutura.`,
                type: 'positive'
            });

            return insights;
        }

        // Renderizar Insights
        function renderInsights(data) {
            const insights = generateInsights(data);
            const container = document.getElementById('insightsContainer');
            
            container.innerHTML = insights.map(insight => `
                <div class="insight-card ${insight.type}">
                    <div class="insight-header">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-title">${insight.title}</div>
                    </div>
                    <div class="insight-content">${insight.content}</div>
                </div>
            `).join('');
        }

        // Gerar An√°lise Detalhada
        function generateAnalysis(data) {
            const analysis = [];

            // Crescimento Bitruck
            const bitruckGrowth = data.map((d, i) => {
                if (i === 0) return { mes: d.mes, change: 0 };
                const change = ((d.bitruck - data[i-1].bitruck) / data[i-1].bitruck * 100).toFixed(1);
                return { mes: d.mes, change };
            });
            const bitruckPositive = bitruckGrowth.filter(d => d.change > 0).length;
            const bitruckNegative = bitruckGrowth.filter(d => d.change < 0).length;

            analysis.push({
                title: 'üöõ An√°lise de Crescimento - Bitruck',
                content: `<strong>Meses com crescimento:</strong> ${bitruckPositive}<br><strong>Meses com queda:</strong> ${bitruckNegative}<br><strong>Tend√™ncia:</strong> ${bitruckPositive > bitruckNegative ? 'CRESCIMENTO ‚Üë' : 'QUEDA ‚Üì'}`
            });

            // Decr√©scimo Carreta
            const carretaGrowth = data.map((d, i) => {
                if (i === 0) return { mes: d.mes, change: 0 };
                const change = ((d.carreta - data[i-1].carreta) / data[i-1].carreta * 100).toFixed(1);
                return { mes: d.mes, change };
            });
            const carretaPositive = carretaGrowth.filter(d => d.change > 0).length;
            const carretaNegative = carretaGrowth.filter(d => d.change < 0).length;

            analysis.push({
                title: 'üöö An√°lise de Decr√©scimo - Carreta',
                content: `<strong>Meses com crescimento:</strong> ${carretaPositive}<br><strong>Meses com queda:</strong> ${carretaNegative}<br><strong>Tend√™ncia:</strong> ${carretaNegative > carretaPositive ? 'QUEDA ‚Üì' : 'CRESCIMENTO ‚Üë'}`
            });

            // Volatilidade
            const bitruckValues = data.map(d => d.bitruck);
            const carretaValues = data.map(d => d.carreta);
            const bitruckStdDev = Math.sqrt(bitruckValues.reduce((sum, val) => sum + Math.pow(val - bitruckValues.reduce((a, b) => a + b, 0) / bitruckValues.length, 2), 0) / bitruckValues.length).toFixed(1);
            const carretaStdDev = Math.sqrt(carretaValues.reduce((sum, val) => sum + Math.pow(val - carretaValues.reduce((a, b) => a + b, 0) / carretaValues.length, 2), 0) / carretaValues.length).toFixed(1);

            analysis.push({
                title: 'üìä Volatilidade Operacional',
                content: `<strong>Bitruck (Desvio Padr√£o):</strong> ${bitruckStdDev}<br><strong>Carreta (Desvio Padr√£o):</strong> ${carretaStdDev}<br><strong>Interpreta√ß√£o:</strong> Bitruck mais vol√°til, Carreta mais est√°vel`
            });

            // Picos e Vales
            const bitruckMax = Math.max(...bitruckValues);
            const bitruckMin = Math.min(...bitruckValues);
            const carretaMax = Math.max(...carretaValues);
            const carretaMin = Math.min(...carretaValues);

            analysis.push({
                title: 'üéØ Picos e Vales',
                content: `<strong>Bitruck:</strong> M√°x ${bitruckMax} | M√≠n ${bitruckMin} | Amplitude ${bitruckMax - bitruckMin}<br><strong>Carreta:</strong> M√°x ${carretaMax} | M√≠n ${carretaMin} | Amplitude ${carretaMax - carretaMin}`
            });

            // Faturamento
            const revenueValues = data.map(d => d.faturamento);
            const revenueMax = Math.max(...revenueValues);
            const revenueMin = Math.min(...revenueValues);
            const revenueAvg = (revenueValues.reduce((a, b) => a + b, 0) / revenueValues.length).toFixed(0);

            analysis.push({
                title: 'üí∞ An√°lise de Faturamento',
                content: `<strong>M√°ximo:</strong> ${formatCurrency(revenueMax)}<br><strong>M√≠nimo:</strong> ${formatCurrency(revenueMin)}<br><strong>M√©dia:</strong> ${formatCurrency(revenueAvg)}`
            });

            return analysis;
        }

        // Renderizar An√°lise
        function renderAnalysis(data) {
            const analysis = generateAnalysis(data);
            const container = document.getElementById('analysisContainer');
            
            container.innerHTML = analysis.map(item => `
                <div class="analysis-item">
                    <div class="analysis-item-title">${item.title}</div>
                    <div class="analysis-item-content">${item.content}</div>
                </div>
            `).join('');
        }

        // Gerar Considera√ß√µes
        function generateConsiderations(data) {
            const considerations = [];

            considerations.push({
                title: 'üéØ Estrat√©gia de Transi√ß√£o',
                content: 'A mudan√ßa de Carreta para Bitruck reflete decis√£o estrat√©gica de priorizar flexibilidade operacional e reduzir custos de manuten√ß√£o de frota maior.'
            });

            considerations.push({
                title: 'üìà Impacto no Faturamento',
                content: 'Apesar da redu√ß√£o de 12,8% no total de ve√≠culos, o faturamento manteve-se robusto com crescimento de 9,8%, indicando maior efici√™ncia por ve√≠culo.'
            });

            considerations.push({
                title: '‚ö° Efici√™ncia Operacional',
                content: 'Bitruck apresenta maior flexibilidade para ajustes r√°pidos de demanda, enquanto Carreta mant√©m capacidade de carga quando necess√°rio para opera√ß√µes espec√≠ficas.'
            });

            considerations.push({
                title: 'üìä Sazonalidade Detectada',
                content: 'Picos de demanda em maio-agosto (at√© 180 ve√≠culos) e vales em dezembro-abril (at√© 111 ve√≠culos) sugerem padr√£o sazonal que deve ser considerado no planejamento.'
            });

            considerations.push({
                title: 'üîÑ Estabilidade Recente',
                content: 'Outubro/2025 consolida a nova estrutura com 149 ve√≠culos (82 Bitruck + 67 Carreta) e faturamento de R$ 1,76M, indicando estabiliza√ß√£o ap√≥s transi√ß√£o.'
            });

            considerations.push({
                title: '‚ö†Ô∏è Monitoramento Cont√≠nuo',
                content: 'Recomenda-se monitorar taxa de crescimento de Bitruck (74,5%) e redu√ß√£o de Carreta (-33,7%) para garantir que a transi√ß√£o n√£o comprometa capacidade operacional futura.'
            });

            return considerations;
        }

        // Renderizar Considera√ß√µes
        function renderConsiderations(data) {
            const considerations = generateConsiderations(data);
            const container = document.getElementById('considerationsContainer');
            
            container.innerHTML = considerations.map(item => `
                <div class="analysis-item">
                    <div class="analysis-item-title">${item.title}</div>
                    <div class="analysis-item-content">${item.content}</div>
                </div>
            `).join('');
        }

        // Criar gr√°ficos
        function createCharts() {
            const meses = currentData.map(d => d.mes);
            const bitruck = currentData.map(d => d.bitruck);
            const carreta = currentData.map(d => d.carreta);
            const total = currentData.map(d => d.total);
            const faturamento = currentData.map(d => d.faturamento);

            const lineWidth = parseInt(document.getElementById('lineWidth').value);
            const pointSize = parseInt(document.getElementById('pointSize').value);
            const opacity = parseFloat(document.getElementById('opacity').value);
            const showLegend = document.getElementById('showLegend').checked;
            const showGrid = document.getElementById('showGrid').checked;
            const showPoints = document.getElementById('showPoints').checked;

            // Gr√°fico de Linha
            const ctxLine = document.getElementById('lineChart').getContext('2d');
            if (charts.lineChart) charts.lineChart.destroy();

            charts.lineChart = new Chart(ctxLine, {
                type: chartTypes.line,
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Bitruck',
                            data: bitruck,
                            borderColor: colors.bitruck,
                            backgroundColor: colors.bitruck + Math.round(opacity * 255).toString(16).padStart(2, '0'),
                            borderWidth: lineWidth,
                            fill: true,
                            tension: 0.4,
                            pointRadius: showPoints ? pointSize : 0,
                            pointHoverRadius: pointSize + 2
                        },
                        {
                            label: 'Carreta',
                            data: carreta,
                            borderColor: colors.carreta,
                            backgroundColor: colors.carreta + Math.round(opacity * 255).toString(16).padStart(2, '0'),
                            borderWidth: lineWidth,
                            fill: true,
                            tension: 0.4,
                            pointRadius: showPoints ? pointSize : 0,
                            pointHoverRadius: pointSize + 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#e0e0e0',
                            font: { size: 10, weight: 'bold' },
                            align: 'top',
                            offset: 5,
                            formatter: function(value) { return value; }
                        },
                        legend: { display: showLegend, labels: { font: { size: 14 }, padding: 15, color: '#e0e0e0' } },
                        tooltip: { enabled: document.getElementById('showTooltip').checked }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: showGrid, color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#7a7a9e' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#7a7a9e' }
                        }
                    }
                }
            });

            // Gr√°fico de Barras
            const ctxBar = document.getElementById('barChart').getContext('2d');
            if (charts.barChart) charts.barChart.destroy();

            charts.barChart = new Chart(ctxBar, {
                type: chartTypes.bar,
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Bitruck',
                            data: bitruck,
                            backgroundColor: colors.bitruck,
                            borderRadius: 5
                        },
                        {
                            label: 'Carreta',
                            data: carreta,
                            backgroundColor: colors.carreta,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            color: "#e0e0e0",
                            font: { size: 10, weight: "bold" },
                            align: "end",
                            anchor: "end",
                            offset: 2,
                            formatter: function(value) { return value; }
                        },
                        legend: { display: showLegend, labels: { font: { size: 14 }, padding: 15, color: '#e0e0e0' } },
                        tooltip: { enabled: document.getElementById('showTooltip').checked }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: showGrid, color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#7a7a9e' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#7a7a9e' }
                        }
                    }
                }
            });

            // Gr√°fico de Pizza
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            if (charts.pieChart) charts.pieChart.destroy();

            const totalBitruck = bitruck.reduce((a, b) => a + b, 0);
            const totalCarreta = carreta.reduce((a, b) => a + b, 0);

            charts.pieChart = new Chart(ctxPie, {
                type: chartTypes.pie,
                data: {
                    labels: ['Bitruck', 'Carreta'],
                    datasets: [{
                        data: [totalBitruck, totalCarreta],
                        backgroundColor: [colors.bitruck, colors.carreta],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#ffffff',
                            font: { size: 14, weight: 'bold' },
                            formatter: function(value, context) {
                                const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return value + '\n(' + percentage + '%)';
                            }
                        },
                        legend: { display: showLegend, labels: { font: { size: 14 }, padding: 20, color: '#e0e0e0' } },
                        tooltip: { enabled: document.getElementById('showTooltip').checked }
                    }
                }
            });

            // Gr√°fico Total
            const ctxTotal = document.getElementById('totalChart').getContext('2d');
            if (charts.totalChart) charts.totalChart.destroy();

            charts.totalChart = new Chart(ctxTotal, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Total de Ve√≠culos',
                        data: total,
                        borderColor: colors.total,
                        backgroundColor: colors.total + Math.round(opacity * 255).toString(16).padStart(2, '0'),
                        borderWidth: lineWidth,
                        fill: true,
                        tension: 0.4,
                        pointRadius: showPoints ? pointSize : 0,
                        pointHoverRadius: pointSize + 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#e0e0e0',
                            font: { size: 10, weight: 'bold' },
                            align: 'top',
                            offset: 5,
                            formatter: function(value) { return value; }
                        },
                        legend: { display: showLegend, labels: { font: { size: 14 }, padding: 15, color: '#e0e0e0' } },
                        tooltip: { enabled: document.getElementById('showTooltip').checked }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: showGrid, color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#7a7a9e' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#7a7a9e' }
                        }
                    }
                }
            });

            // Gr√°fico Faturamento
            const ctxRevenue = document.getElementById('revenueChart').getContext('2d');
            if (charts.revenueChart) charts.revenueChart.destroy();

            charts.revenueChart = new Chart(ctxRevenue, {
                type: 'bar',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Faturamento (R$)',
                        data: faturamento,
                        backgroundColor: colors.revenue,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#e0e0e0',
                            font: { size: 9, weight: 'bold' },
                            align: 'end',
                            anchor: 'end',
                            offset: 2,
                            formatter: function(value) {
                                return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                            }
                        },
                        legend: { display: showLegend, labels: { font: { size: 14 }, padding: 15, color: '#e0e0e0' } },
                        tooltip: {
                            enabled: document.getElementById('showTooltip').checked,
                            callbacks: {
                                label: function(context) {
                                    return 'Faturamento: ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: showGrid, color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: {
                                color: '#7a7a9e',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#7a7a9e' }
                        }
                    }
                }
            });
        }

        // Aplicar filtro preset
        function applyPreset(filter) {
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            let filteredData = [...rawData];
            
            if (filter === '2024') {
                filteredData = rawData.filter(d => d.mes.includes('/24'));
            } else if (filter === '2025') {
                filteredData = rawData.filter(d => d.mes.includes('/25'));
            } else if (filter === 'last6') {
                filteredData = rawData.slice(-6);
            } else if (filter === 'last3') {
                filteredData = rawData.slice(-3);
            }

            currentData = filteredData;
            updateAllCharts();
        }

        // Aplicar range customizado
        function applyCustomRange() {
            const startIdx = parseInt(document.getElementById('startMonth').value);
            const endIdx = parseInt(document.getElementById('endMonth').value);
            
            if (startIdx > endIdx) {
                alert('O m√™s inicial deve ser anterior ao m√™s final!');
                return;
            }
            
            currentData = rawData.slice(startIdx, endIdx + 1);
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            updateAllCharts();
        }

        // Atualizar tipo de gr√°fico
        function updateChartType(chartName, type) {
            chartTypes[chartName] = type;
            updateAllCharts();
        }

        // Atualizar cores
        function updateColors() {
            colors.bitruck = document.getElementById('colorBitruck').value;
            colors.carreta = document.getElementById('colorCarreta').value;
            colors.total = document.getElementById('colorTotal').value;
            colors.revenue = document.getElementById('colorRevenue').value;
            updateAllCharts();
        }

        // Atualizar visualiza√ß√£o
        function updateVisualization() {
            updateAllCharts();
        }

        // Atualizar op√ß√µes avan√ßadas
        function updateAdvanced() {
            document.getElementById('lineWidthValue').textContent = document.getElementById('lineWidth').value;
            document.getElementById('pointSizeValue').textContent = document.getElementById('pointSize').value;
            document.getElementById('opacityValue').textContent = document.getElementById('opacity').value;
            updateAllCharts();
        }

        // Atualizar todos os gr√°ficos
        function updateAllCharts() {
            renderKPIs(currentData);
            renderInsights(currentData);
            renderAnalysis(currentData);
            renderConsiderations(currentData);
            createCharts();
        }

        // Download de gr√°fico
        function downloadChart(chartId) {
            const chart = charts[chartId];
            if (!chart) return;
            
            const link = document.createElement('a');
            link.href = chart.canvas.toDataURL('image/png');
            link.download = `grafico_${chartId}_${new Date().getTime()}.png`;
            link.click();
        }

        // Tela cheia
        function toggleChartFullscreen(chartId) {
            const modal = document.getElementById('fullscreenModal');
            const canvas = document.getElementById('fullscreenChart');
            const chart = charts[chartId];
            
            if (!chart) return;

            modal.classList.add('show');
            
            setTimeout(() => {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: chart.config.type,
                    data: chart.data,
                    options: chart.options
                });
            }, 100);
        }

        function closeFullscreen(event) {
            if (event && event.target.id !== 'fullscreenModal') return;
            document.getElementById('fullscreenModal').classList.remove('show');
        }

        // Salvar configura√ß√£o
        function savePreset() {
            const config = {
                colors,
                chartTypes,
                lineWidth: document.getElementById('lineWidth').value,
                pointSize: document.getElementById('pointSize').value,
                opacity: document.getElementById('opacity').value,
                showLegend: document.getElementById('showLegend').checked,
                showGrid: document.getElementById('showGrid').checked,
                showPoints: document.getElementById('showPoints').checked,
                showTooltip: document.getElementById('showTooltip').checked
            };
            
            localStorage.setItem('dashboardConfig', JSON.stringify(config));
            alert('‚úÖ Configura√ß√£o salva com sucesso!');
        }

        // Carregar configura√ß√£o
        function loadPreset() {
            const config = JSON.parse(localStorage.getItem('dashboardConfig'));
            if (!config) {
                alert('‚ùå Nenhuma configura√ß√£o salva encontrada!');
                return;
            }
            
            colors = config.colors;
            chartTypes = config.chartTypes;
            document.getElementById('colorBitruck').value = colors.bitruck;
            document.getElementById('colorCarreta').value = colors.carreta;
            document.getElementById('colorTotal').value = colors.total;
            document.getElementById('colorRevenue').value = colors.revenue;
            document.getElementById('lineChartType').value = chartTypes.line;
            document.getElementById('barChartType').value = chartTypes.bar;
            document.getElementById('pieChartType').value = chartTypes.pie;
            document.getElementById('lineWidth').value = config.lineWidth;
            document.getElementById('pointSize').value = config.pointSize;
            document.getElementById('opacity').value = config.opacity;
            document.getElementById('showLegend').checked = config.showLegend;
            document.getElementById('showGrid').checked = config.showGrid;
            document.getElementById('showPoints').checked = config.showPoints;
            document.getElementById('showTooltip').checked = config.showTooltip;
            
            updateAdvanced();
            updateAllCharts();
            alert('‚úÖ Configura√ß√£o carregada com sucesso!');
        }

        // Resetar tudo
        function resetAll() {
            if (!confirm('Tem certeza que deseja resetar todas as configura√ß√µes?')) return;
            location.reload();
        }

        // Dados AB Brasil (independentes dos demais)
        const abBrasilData = [
            {"mes": "jan/25", "percentual": 30.97},
            {"mes": "fev/25", "percentual": 31.89},
            {"mes": "mar/25", "percentual": 33.81},
            {"mes": "abr/25", "percentual": 26.18},
            {"mes": "mai/25", "percentual": 32.08},
            {"mes": "jun/25", "percentual": 34.79},
            {"mes": "jul/25", "percentual": 31.16},
            {"mes": "ago/25", "percentual": 33.64},
            {"mes": "set/25", "percentual": 32.03},
            {"mes": "out/25", "percentual": 31.50}
        ];

        // Fun√ß√£o para criar gr√°ficos AB Brasil
        function createABBrasilCharts() {
            // Gr√°fico de Linha
            const ctxABLine = document.getElementById('abBrasilLineChart');
            if (ctxABLine) {
                charts.abBrasilLineChart = new Chart(ctxABLine, {
                    type: 'line',
                    data: {
                        labels: abBrasilData.map(d => d.mes.toUpperCase()),
                        datasets: [{
                            label: 'AB Brasil (%)',
                            data: abBrasilData.map(d => d.percentual),
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#00d4ff',
                            pointBorderColor: '#1a1a2e',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            datalabels: {
                                display: true,
                                color: '#ffffff',
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                borderRadius: 4,
                                padding: 6,
                                font: { size: 11, weight: 'bold' },
                                align: 'top',
                                offset: 8,
                                formatter: function(value) { return value.toFixed(2) + '%'; }
                            },
                            legend: { display: true, labels: { font: { size: 14 }, padding: 15, color: '#e0e0e0' } },
                            tooltip: { enabled: true, callbacks: { label: function(context) { return 'AB Brasil: ' + context.parsed.y.toFixed(2) + '%'; } } }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 40, grid: { display: true, color: 'rgba(255, 255, 255, 0.05)' }, ticks: { color: '#7a7a9e', callback: function(value) { return value + '%'; } } },
                            x: { grid: { display: false }, ticks: { color: '#7a7a9e' } }
                        }
                    }
                });
            }

            // Gr√°fico de Barras
            const ctxABBar = document.getElementById('abBrasilBarChart');
            if (ctxABBar) {
                charts.abBrasilBarChart = new Chart(ctxABBar, {
                    type: 'bar',
                    data: {
                        labels: abBrasilData.map(d => d.mes.toUpperCase()),
                        datasets: [{
                            label: 'AB Brasil (%)',
                            data: abBrasilData.map(d => d.percentual),
                            backgroundColor: abBrasilData.map(d => { if (d.percentual >= 33) return 'rgba(0, 212, 255, 0.8)'; if (d.percentual >= 30) return 'rgba(255, 193, 7, 0.8)'; return 'rgba(255, 82, 82, 0.8)'; }),
                            borderColor: abBrasilData.map(d => { if (d.percentual >= 33) return '#00d4ff'; if (d.percentual >= 30) return '#ffc107'; return '#ff5252'; }),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            datalabels: {
                                display: true,
                                color: '#ffffff',
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                borderRadius: 4,
                                padding: 6,
                                font: { size: 11, weight: 'bold' },
                                align: 'end',
                                anchor: 'end',
                                offset: 4,
                                formatter: function(value) { return value.toFixed(2) + '%'; }
                            },
                            legend: { display: false },
                            tooltip: { enabled: true, callbacks: { label: function(context) { return 'AB Brasil: ' + context.parsed.y.toFixed(2) + '%'; } } }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 40, grid: { display: true, color: 'rgba(255, 255, 255, 0.05)' }, ticks: { color: '#7a7a9e', callback: function(value) { return value + '%'; } } },
                            x: { grid: { display: false }, ticks: { color: '#7a7a9e' } }
                        }
                    }
                });
            }

            // Gr√°fico Trimestral
            const ctxABTrim = document.getElementById('abBrasilTrimChart');
            if (ctxABTrim) {
                const trimestralData = [
                    { trimestre: 'Q1 2025', media: ((30.97 + 31.89 + 33.81) / 3).toFixed(2) },
                    { trimestre: 'Q2 2025', media: ((26.18 + 32.08 + 34.79) / 3).toFixed(2) },
                    { trimestre: 'Q3 2025', media: ((31.16 + 33.64 + 32.03) / 3).toFixed(2) },
                    { trimestre: 'Q4 2025', media: parseFloat(31.50).toFixed(2) }
                ];
                charts.abBrasilTrimChart = new Chart(ctxABTrim, {
                    type: 'bar',
                    data: {
                        labels: trimestralData.map(d => d.trimestre),
                        datasets: [{
                            label: 'M√©dia Trimestral (%)',
                            data: trimestralData.map(d => parseFloat(d.media)),
                            backgroundColor: 'rgba(156, 39, 176, 0.8)',
                            borderColor: '#9c27b0',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            datalabels: {
                                display: true,
                                color: '#ffffff',
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                borderRadius: 4,
                                padding: 6,
                                font: { size: 12, weight: 'bold' },
                                align: 'end',
                                anchor: 'end',
                                offset: 4,
                                formatter: function(value) { return value.toFixed(2) + '%'; }
                            },
                            legend: { display: false },
                            tooltip: { enabled: true, callbacks: { label: function(context) { return 'M√©dia: ' + context.parsed.y.toFixed(2) + '%'; } } }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 40, grid: { display: true, color: 'rgba(255, 255, 255, 0.05)' }, ticks: { color: '#7a7a9e', callback: function(value) { return value + '%'; } } },
                            x: { grid: { display: false }, ticks: { color: '#7a7a9e' } }
                        }
                    }
                });
            }
        }

        // Inicializar
        window.addEventListener('load', () => {
            initializeSelects();
            updateAllCharts();
            createABBrasilCharts();
        });
    </script>
</body>
</html>
